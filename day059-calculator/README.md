# 🧮 Calculator

シンプル電卓を作りました。
eval()を使って計算式を評価する前に、正規表現で安全性チェックを導入しました。これにより「数値・演算子・括弧」以外の不正な入力（例：モジュールのインポートやコード実行）をブロックし、安全な範囲で使えるCLI電卓に仕上げています。

## 🚀 実行方法
```bash
cd day59-calculator
python main.py
```

## 💡 使い方

### 📝 基本的な計算
```
式を入力してください: 2 + 3
答え: 5

式を入力してください: 10 * 5
答え: 50

式を入力してください: 100 / 4
答え: 25.0
```

### 🔢 対応している演算
- **加算**: `+` (例: `5 + 3`)
- **減算**: `-` (例: `10 - 4`)
- **乗算**: `*` (例: `6 * 7`)
- **除算**: `/` (例: `15 / 3`)
- **整数除算**: `//` (例: `17 // 5`)
- **余り**: `%` (例: `17 % 5`)
- **べき乗**: `**` (例: `2 ** 3`)
- **括弧**: `()` (例: `(2 + 3) * 4`)

### 🚪 終了方法
以下のいずれかを入力すると終了します：
- `exit`
- `quit`
- `EXIT` (大文字小文字は問いません)
- `Quit` など

### 🛡️ セキュリティ機能
- 数字、演算子、括弧、小数点以外の文字は受け付けません
- 危険なコマンドの実行を防ぎます

## 📖 学んだことや今後の改善案（学習ログ）

### 🔧 核心的な学習内容

#### 1️⃣ **`eval()` 関数の理解**

```python
expr = "2 + 3"
result = eval(expr)  # 文字列を Python コードとして実行
print(result)        # → 5
```

**`eval()` の特徴**:
- 文字列として渡された **Python の式を実行** する
- **数式計算に便利** だが、セキュリティリスクもある
- **強力な機能** のため慎重な使用が必要

**動作例**:
| 入力文字列 | `eval()` の結果 |
|-----------|----------------|
| `"2+3"` | `5` |
| `"10*5"` | `50` |
| `"2**3"` | `8` (2の3乗) |
| `"(5+3)*2"` | `16` |

#### 2️⃣ **正規表現による入力検証**

```python
def is_safe_expression(expr):
    pattern = r'^[0-9+\-*/().\s]+$'
    return re.match(pattern, expr) is not None
```

**正規表現パターンの解説**:
- `^` : 文字列の開始
- `[0-9+\-*/().\s]+` : 許可する文字のセット
  - `0-9` : 数字
  - `+\-*/` : 演算子 (`-` は `\-` でエスケープ)
  - `()` : 括弧
  - `.` : 小数点
  - `\s` : 空白文字
  - `+` : 1文字以上
- `$` : 文字列の終了

**安全性の確保**:
```python
# ✅ 安全な入力例
"2 + 3"     # → True
"(5*2)/3"   # → True

# ❌ 危険な入力例
"import os" # → False
"print(x)"  # → False
```

#### 3️⃣ **`lower()` メソッドの活用**

```python
if expr.lower() in {"exit", "quit"}:
```

**`lower()` の役割**:
- すべての **大文字を小文字に変換**
- **大文字小文字を区別しない** 比較を実現
- **ユーザビリティの向上** に貢献

**実際の動作**:
| ユーザー入力 | `expr.lower()` | 判定結果 |
|-------------|----------------|----------|
| `"EXIT"` | `"exit"` | 終了 ✅ |
| `"Quit"` | `"quit"` | 終了 ✅ |
| `"QUIT"` | `"quit"` | 終了 ✅ |

#### 4️⃣ **多層的なエラーハンドリング**

```python
if is_safe_expression(expr):           # 1. 事前チェック
    try:                               # 2. 実行試行
        result = eval(expr)
        print(f"答え: {result}")
    except ZeroDivisionError:          # 3a. 具体的エラー
        print("ゼロで割ることはできません。")
    except Exception as e:             # 3b. 汎用エラー
        print(f"エラーが発生しました: {e}")
else:                                  # 4. 事前チェック失敗
    print("無効な文字が含まれています")
```

**エラーハンドリングの階層**:
1. **事前チェック**: 危険な入力を排除
2. **具体的エラー**: よく起こるエラーに専用メッセージ
3. **汎用エラー**: その他のエラーに詳細情報を表示

**各エラーの例**:
```python
# ZeroDivisionError
"10 / 0" → "ゼロで割ることはできません。"

# SyntaxError  
"2 + "   → "エラーが発生しました: unexpected EOF while parsing"

# 無効な文字
"print('hello')" → "無効な文字が含まれています"
```

### 💡 重要な学習ポイント

#### 🛡️ **セキュリティ意識**
- `eval()` の危険性を理解
- 正規表現による入力検証の重要性
- 多重防御の考え方

#### 🎯 **エラーハンドリングの設計**
- 具体的なエラーから汎用的なエラーへの順序
- ユーザーフレンドリーなエラーメッセージ
- `Exception as e` による詳細情報の取得

#### 🔧 **文字列処理のテクニック**
- `lower()` による大文字小文字の統一
- `in` 演算子とセット `{}` の組み合わせ
- 複数の終了条件への対応

### 🚀 今後の改善・発展アイデア

#### 📈 **機能拡張**
- **履歴機能**: 過去の計算結果を保存・表示
- **数学関数**: `sin`, `cos`, `sqrt` などの対応
- **変数機能**: `x = 5`, `x + 2` のような変数の使用
- **単位変換**: 長さ、重さ、温度などの単位変換

#### 🖥️ **インターフェース改善**
- **GUI版**: `tkinter` を使用したウィンドウアプリ
- **Web版**: `Flask` を使用したWebアプリ
- **音声入力**: 音声認識による計算式の入力

#### 🔧 **技術的改善**
- **AST使用**: `ast.literal_eval()` によるより安全な評価
- **独自パーサー**: `eval()` を使わない独自の計算エンジン
- **テストコード**: 単体テストによる品質向上

#### 📊 **高度な機能**
- **グラフ描画**: 関数のグラフを表示
- **統計計算**: 平均、標準偏差などの統計関数
- **行列計算**: 線形代数の基本演算
- **プログラミング機能**: 簡単なスクリプト実行

### 🎓 **この実装から学べること**

1. **安全なコーディング**: セキュリティを考慮した実装
2. **エラーハンドリング**: 堅牢なアプリケーション設計  
3. **ユーザビリティ**: 使いやすいインターフェース設計
4. **正規表現**: パターンマッチングの実用的な活用
5. **文字列処理**: 実用的な文字列操作テクニック

この電卓アプリは、**基本的でありながら多くの重要な概念**を含んでいる、優れた学習プロジェクトです！🎉
