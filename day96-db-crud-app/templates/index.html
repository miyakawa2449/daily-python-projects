<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ã‚¿ã‚¹ã‚¯ç®¡ç† - Day96 CRUD App</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>âœ…</text></svg>">
</head>
<body>
    <div class="container">
        <!-- ãƒ˜ãƒƒãƒ€ãƒ¼ -->
        <div class="header fade-in">
            <h1>ğŸ“ ã‚¿ã‚¹ã‚¯ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ </h1>
            <p>åŠ¹ç‡çš„ã«ã‚¿ã‚¹ã‚¯ã‚’ç®¡ç†ã—ã¦ã€ç”Ÿç”£æ€§ã‚’å‘ä¸Šã•ã›ã¾ã—ã‚‡ã†</p>
        </div>

        <!-- æ–°è¦è¿½åŠ ãƒ•ã‚©ãƒ¼ãƒ  -->
        <div class="card fade-in">
            <h3 style="margin-bottom: 20px; color: #495057; text-align: center;">
                â• æ–°ã—ã„ã‚¿ã‚¹ã‚¯ã‚’è¿½åŠ 
            </h3>
            <form method="POST" action="{{ url_for('add') }}" id="addTaskForm">
                <div class="form-group">
                    <input 
                        type="text" 
                        name="title" 
                        class="form-control" 
                        placeholder="æ–°ã—ã„ã‚¿ã‚¹ã‚¯ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„..." 
                        required 
                        maxlength="200"
                        id="newTaskTitle">
                </div>
                <div style="text-align: center;">
                    <button type="submit" class="btn btn-primary btn-lg">
                        ğŸ“ ã‚¿ã‚¹ã‚¯ã‚’è¿½åŠ 
                    </button>
                </div>
            </form>
        </div>

        <!-- ã‚¿ã‚¹ã‚¯ãƒªã‚¹ãƒˆ -->
        <div class="card fade-in">
            {% if tasks %}
                <h2 style="margin-bottom: 25px; color: #495057; font-weight: 500;">
                    ğŸ“‹ ã‚¿ã‚¹ã‚¯ä¸€è¦§ <span style="font-size: 0.8em; color: #6c757d;">({{ tasks|length }}ä»¶)</span>
                </h2>
                
                <ul class="task-list">
                    {% for task in tasks %}
                    <li class="task-item {% if task.done %}completed{% endif %}" data-animation-delay="{{ loop.index0 }}">
                        <div class="task-content">
                            <div class="task-title {% if task.done %}completed{% endif %}">
                                {{ task.title }}
                            </div>
                            <div class="task-status {% if task.done %}status-completed{% else %}status-pending{% endif %}">
                                {% if task.done %}
                                    âœ… å®Œäº†æ¸ˆã¿
                                {% else %}
                                    â³ æœªå®Œäº†
                                {% endif %}
                            </div>
                        </div>
                        
                        <div class="task-actions">
                            <a href="{{ url_for('edit', task_id=task.id) }}" class="btn btn-warning btn-sm">
                                âœï¸ ç·¨é›†
                            </a>
                            <a href="{{ url_for('complete', task_id=task.id) }}" class="btn btn-success btn-sm">
                                âœ… å®Œäº†
                            </a>
                            <a href="{{ url_for('delete', task_id=task.id) }}" 
                               class="btn btn-danger btn-sm"
                               onclick="return confirm('ã“ã®ã‚¿ã‚¹ã‚¯ã‚’å‰Šé™¤ã—ã¦ã‚‚ã‚ˆã‚ã—ã„ã§ã™ã‹ï¼Ÿ')">
                                ğŸ—‘ï¸ å‰Šé™¤
                            </a>
                        </div>
                    </li>
                    {% endfor %}
                </ul>
                
                <!-- ã‚µãƒãƒªãƒ¼ -->
                {% set completed_count = tasks | selectattr('done') | list | length %}
                {% set pending_count = tasks | rejectattr('done') | list | length %}
                
                <div class="task-summary">
                    <div class="summary-stats">
                        <div class="stat-item">
                            <div class="stat-number completed">{{ completed_count }}</div>
                            <div class="stat-label">å®Œäº†</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-number pending">{{ pending_count }}</div>
                            <div class="stat-label">æœªå®Œäº†</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-number total">{{ tasks|length }}</div>
                            <div class="stat-label">ç·æ•°</div>
                        </div>
                    </div>
                </div>
            {% else %}
                <!-- ç©ºã®çŠ¶æ…‹ -->
                <div class="empty-state">
                    <div class="empty-state-icon">ğŸ“</div>
                    <h3>ã‚¿ã‚¹ã‚¯ãŒã‚ã‚Šã¾ã›ã‚“</h3>
                    <p>æœ€åˆã®ã‚¿ã‚¹ã‚¯ã‚’è¿½åŠ ã—ã¦ã€ç®¡ç†ã‚’å§‹ã‚ã¾ã—ã‚‡ã†ï¼</p>
                </div>
            {% endif %}
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³é…å»¶ã‚’JavaScriptã§è¨­å®š
            const taskItems = document.querySelectorAll('.task-item');
            taskItems.forEach((item, index) => {
                const delay = item.dataset.animationDelay || index;
                item.style.animationDelay = `${delay * 0.1}s`;
                item.classList.add('slide-in');
            });

            // ãƒ›ãƒãƒ¼åŠ¹æœ
            taskItems.forEach(item => {
                item.addEventListener('mouseenter', function() {
                    this.style.transform = 'translateX(10px)';
                });
                item.addEventListener('mouseleave', function() {
                    this.style.transform = 'translateX(0)';
                });
            });

            // å‰Šé™¤ç¢ºèªã®å¼·åŒ–
            const deleteButtons = document.querySelectorAll('.btn-danger');
            deleteButtons.forEach(button => {
                button.addEventListener('click', function(e) {
                    if (!confirm('âš ï¸ æœ¬å½“ã«ã“ã®ã‚¿ã‚¹ã‚¯ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ\nã“ã®æ“ä½œã¯å–ã‚Šæ¶ˆã›ã¾ã›ã‚“ã€‚')) {
                        e.preventDefault();
                    }
                });
            });

            // æ–°è¦ã‚¿ã‚¹ã‚¯è¿½åŠ ãƒ•ã‚©ãƒ¼ãƒ ã®å¼·åŒ–
            const addTaskForm = document.getElementById('addTaskForm');
            const newTaskInput = document.getElementById('newTaskTitle');

            addTaskForm.addEventListener('submit', function(e) {
                const title = newTaskInput.value.trim();
                if (title === '') {
                    alert('âš ï¸ ã‚¿ã‚¹ã‚¯ã‚¿ã‚¤ãƒˆãƒ«ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚');
                    newTaskInput.focus();
                    e.preventDefault();
                    return;
                }

                if (title.length > 200) {
                    alert('âš ï¸ ã‚¿ã‚¹ã‚¯ã‚¿ã‚¤ãƒˆãƒ«ã¯200æ–‡å­—ä»¥å†…ã§å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚');
                    newTaskInput.focus();
                    e.preventDefault();
                    return;
                }

                // é€ä¿¡ãƒœã‚¿ãƒ³ã‚’ä¸€æ™‚çš„ã«ç„¡åŠ¹åŒ–
                const submitBtn = this.querySelector('button[type="submit"]');
                submitBtn.disabled = true;
                submitBtn.innerHTML = 'ğŸ“ è¿½åŠ ä¸­...';
            });

            // Enterã‚­ãƒ¼ã§ã®é€ä¿¡
            newTaskInput.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    e.preventDefault();
                    addTaskForm.submit();
                }
            });

            // æ–‡å­—æ•°ã‚«ã‚¦ãƒ³ãƒˆï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰
            newTaskInput.addEventListener('input', function() {
                const length = this.value.length;
                if (length > 180) {
                    this.style.borderColor = '#ffc107';
                } else if (length > 200) {
                    this.style.borderColor = '#dc3545';
                } else {
                    this.style.borderColor = '#34495e';
                }
            });

            // ãƒ•ã‚©ãƒ¼ã‚«ã‚¹æ™‚ã®ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³
            newTaskInput.addEventListener('focus', function() {
                this.style.transform = 'scale(1.02)';
                this.style.transition = 'transform 0.2s ease';
            });

            newTaskInput.addEventListener('blur', function() {
                this.style.transform = 'scale(1)';
            });
        });
    </script>
</body>
</html>
